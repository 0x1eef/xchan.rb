#!/bin/sh
file="$1"

if [ "$file" = "" ]; then
    echo "Usage: stresstest /path/to/spec.rb"
    exit 1
fi

for i in $(seq 1 750); do
    bundle exec rspec --fail-fast $file
    if [ "$?" != "0" ]; then
        echo "Error (at iteration ${i})"
        exit $?
    fi
done
echo "OK"
